/* qing-select v0.0.1 | (c) Mycolorway Design | MIT License */
<<<<<<< 996e0cbbe4f90b52cb040cd630cebcdf0cfe3b98
!function(t,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("qing-module")):t.QingSelect=e(t.jQuery,t.QingModule)}(this,function(t,e){var i=require=function t(e,i,o){function n(s,p){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!p&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var a=i[s]={exports:{}};e[s][0].call(a.exports,function(t){var i=e[s][1][t];return n(i?i:t)},a,a.exports,t,e,i,o)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.el=t(this.opts.el)}return s(i,e),i.opts={el:null},i.prototype.getOptions=function(){var e;return e=[],this.el.find("option").each(function(i){return function(i,o){var n,r,s;if(n=t(o),s=n.val())return r=n.data(),n.is(":selected")&&(r.selected=!0),e.push([n.text(),s,r])}}(this)),e},i.prototype.selectOption=function(t){var e;return e=this.el.find("option[value='"+t.value+"']"),e.length>0||(e=this._renderOption(t).appendTo(this.el)),e.prop("selected",!0),this},i.prototype.unselectOption=function(t){var e;return e=this.el.find("option[value='"+t.value+"']"),e.prop("selected",!1),this},i.prototype._renderOption=function(e){return t("<option>",{text:e.name,value:e.value,data:e.data})},i.prototype.getValue=function(){return this.el.val()},i.prototype.setValue=function(t){return this.el.val(t),this},i.prototype.getBlankOption=function(){var t;return t=this.el.find('option:not([value]), option[value=""]'),t.length>0&&t},i}(e),o.exports=r},{}],2:[function(i,o,n){var r,s,p=function(t,e){function i(){this.constructor=t}for(var o in e)l.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=i("./option.coffee"),r=function(e){function i(e){var o;i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.remote=this.opts.remote,this.options=function(){var t,e,i,n;for(i=this.opts.options,n=[],t=0,e=i.length;t<e;t++)o=i[t],n.push(new s(o));return n}.call(this),this.totalOptionSize=this.opts.totalOptionSize}return p(i,e),i.opts={remote:!1,options:[],totalOptionSize:null},i.prototype._fetch=function(e,i){var o,n;if(this.remote&&this.trigger("beforeFetch")!==!1)return n=function(t){return function(o){var n;return o.options=function(){var t,e,i,r;for(i=o.options,r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(new s(n));return r}(),t.trigger("fetch",[o,e]),null!=i?i.call(t,o):void 0}}(this),t.ajax({url:this.remote.url,data:t.extend({},this.remote.params,(o={},o[""+this.remote.searchKey]=e,o)),dataType:"json"}).done(function(t){return n(t)})},i.prototype.filter=function(e,i){var o,n;return o=function(t){return function(o){return t.trigger("beforeFilterComplete",[o,e]),t.trigger("filter",[o,e]),null!=i?i.call(t,o):void 0}}(this),this.remote&&this.options.length<this.totalOptionSize?e?this._fetch(e,o):o({options:this.options,totalSize:this.totalOptionSize}):(n=[],t.each(this.options,function(t,i){if(i.match(e))return n.push(i)}),o({options:n,totalSize:n.length})),null},i.prototype.getOption=function(t){var e;return e=this.options.filter(function(e){return function(e,i){return e.value===t}}(this)),e.length>0?e[0]:null},i}(e),o.exports=r},{"./option.coffee":3}],3:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){this.name=e[0],this.value=e[1].toString(),this.data={},e.length>2&&t.isPlainObject(e[2])&&t.each(e[2],function(e){return function(i,o){return i=i.replace(/^data-/,"").split("-"),t.each(i,function(t,e){if(t>0)return i[t]=e.charAt(0).toUpperCase()+e.slice(1)}),e.data[i.join("")]=o,null}}(this)),this.selected=this.data.selected||!1}return s(i,e),i.prototype.match=function(t){var e,i,o;try{o=new RegExp("(^|\\s)"+t,"i")}catch(t){e=t,o=new RegExp("","i")}return i=this.data.searchKey||this.name,o.test(i)},i}(e),o.exports=r},{}],4:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.disabled=!1,this.selected=[],this._render(),this._bind(),this.opts.selected&&this.addSelected(this.opts.selected))}return s(i,e),i.opts={wrapper:null,placeholder:"",selected:!1,locales:null},i.prototype._render=function(){return this.el=t('<div class="multiple-result-box">\n  <a class="link-add" href="javascript:;">\n    <i class="icon-add">&#65291;</i>\n    <span>'+this.opts.locales.addSelected+"</span>\n  </a>\n</div>").appendTo(this.wrapper),this.linkAdd=this.el.find(".link-add")},i.prototype._bind=function(){return this.el.on("click",".link-add",function(t){return function(e){if(!t.disabled)return t.trigger("addClick")}}(this)),this.el.on("click",".selected-option",function(e){return function(i){var o;if(!e.disabled)return o=t(i.currentTarget),e.trigger("optionClick",[o.data("option")])}}(this)),this.el.on("keydown",".selected-option",function(e){return function(i){var o;if(!e.disabled)return o=t(i.currentTarget),13===i.which?(e.trigger("optionClick",[o.data("option")]),!1):void 0}}(this)),this.linkAdd.on("keydown",function(t){return function(e){if(!t.disabled)return 13===e.which?(t.trigger("enterPress"),!1):38===e.which?(t.trigger("arrowPress",["up"]),!1):40===e.which?(t.trigger("arrowPress",["down"]),!1):void 0}}(this))},i.prototype.addSelected=function(e){var i,o,n;{if(!t.isArray(e))return t('<a href="javascript:;" class="selected-option"\n  data-value="'+e.value+'">\n  <span class="name">'+e.name+'</span>\n  <i class="icon-remove">&#10005;</i>\n</a>').data("option",e).insertBefore(this.linkAdd),this.selected.push(e),this;for(i=0,o=e.length;i<o;i++)n=e[i],this.addSelected(n)}},i.prototype.removeSelected=function(t){var e,i,o,n,r,s;for(this.el.find(".selected-option[data-value='"+t.value+"']").remove(),i=-1,s=this.selected,e=o=0,n=s.length;o<n;e=++o)if(r=s[e],t.value===r.value){i=e;break}return i>-1&&this.selected.splice(i,1),this},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.active=t,this},i.prototype.setDisabled=function(t){if(t!==this.disabled)return this.el.toggleClass("disabled",t),this.disabled=t,this},i.prototype.focus=function(){return this.linkAdd.focus(),this},i}(e),o.exports=r},{}],5:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.highlighted=!1,this._render(),this._bind())}return s(i,e),i.opts={wrapper:null,locales:null,options:null,opitonRenderer:null,totalOptionSize:null,maxListSize:0},i.prototype._render=function(){if(this.el=t('<div class="options-list"></div>').appendTo(this.wrapper),this.opts.options)return this.renderOptions(this.opts.options,this.opts.totalOptionSize)},i.prototype._bind=function(){return this.el.on("click",".option",function(e){return function(i){var o;return o=t(i.currentTarget),e.setHighlighted(o),e.trigger("optionClick",[o]),null}}(this))},i.prototype.renderOptions=function(t,e){var i;if(null==t&&(t=[]),t=t.slice(0,this.opts.maxListSize),this.el.empty().css("min-height",0),this.highlighted=!1,t.length>0?(this.el.append(function(){var e,o,n;for(n=[],e=0,o=t.length;e<o;e++)i=t[e],n.push(this._optionEl(i));return n}.call(this)),e>t.length&&this._renderHiddenSize(e-t.length)):this._renderEmpty(),!this.highlighted)return this.setHighlighted(this.el.find(".option:first"))},i.prototype._optionEl=function(e){var i;return i=t('<div class="option">\n  <div class="left">\n    <span class="name"></span>\n  </div>\n  <div class="right">\n    <span class="hint"></span>\n  </div>\n</div>').data("option",e),i.find(".name").text(e.data.label||e.name),e.data.hint&&i.find(".hint").text(e.data.hint),i.attr("data-value",e.value),i.data("option",e),e.selected&&this.setHighlighted(i),t.isFunction(this.opts.opitonRenderer)&&this.opts.opitonRenderer.call(this,i,e),i},i.prototype._renderEmpty=function(){return this.el.append('<div class="no-options">'+this.opts.locales.noOptions+"</div>")},i.prototype._renderHiddenSize=function(t){var e;return e=this.opts.locales.hiddenSize.replace(/__size__/g,t),this.el.append('<div class="hidden-size">'+e+"</div>")},i.prototype.setLoading=function(t){if(t!==this.loading)return t?setTimeout(function(t){return function(){if(t.loading)return t.el.addClass("loading"),t.el.append('<div class="loading-message">'+t.opts.locales.loading+"</div>")}}(this),500):(this.el.removeClass("loading"),this.el.find(".loading").remove()),this.loading=t,this},i.prototype.setHighlighted=function(t){if("object"!=typeof t&&(t=this.el.find(".option[data-value='"+t+"']")),t.length>0)return this.highlighted&&this.highlighted.removeClass("highlighted"),this.highlighted=t.addClass("highlighted"),this},i.prototype.highlightNextOption=function(){var t;if(t=this.highlighted?this.highlighted.next(".option"):this.el.find(".option:first"),t.length>0)return this.setHighlighted(t)},i.prototype.highlightPrevOption=function(){var t;if(t=this.highlighted?this.highlighted.prev(".option"):this.el.find(".option:first"),t.length>0)return this.setHighlighted(t)},i}(e),o.exports=r},{}],6:[function(i,o,n){var r,s,p,l=function(t,e){function i(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;p=i("./search-box.coffee"),r=i("./options-list.coffee"),s=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,p.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.dataProvider=this.opts.dataProvider,this.searchable=this.dataProvider.totalOptionSize>this.dataProvider.options.length||this.dataProvider.options.length>this.opts.searchableSize,this._render(),this._initChildComponents(),this._bind())}return l(i,e),i.opts={wrapper:null,dataProvider:null,locales:null,maxListSize:0,searchableSize:8,opitonRenderer:null},i.prototype._render=function(){return this.el=t('<div class="qing-select-popover">')},i.prototype._initChildComponents=function(){return this.searchBox=new p({wrapper:this.el,placeholder:this.opts.locales.searchPlaceholder,hidden:!this.searchable}),this.optionsList=new r({wrapper:this.el,locales:this.opts.locales,optionRenderer:this.opts.optionRenderer,totalOptionSize:this.dataProvider.totalOptionSize,maxListSize:this.opts.maxListSize})},i.prototype._bind=function(){return this.searchBox.on("change",function(t){return function(e,i){return t.optionsList.setLoading(!0),t.dataProvider.filter(i)}}(this)),this.dataProvider.on("filter",function(t){return function(e,i,o){return t.optionsList.setLoading(!1),t.optionsList.renderOptions(i.options,i.totalSize)}}(this)),this.searchBox.on("enterPress",function(t){return function(e){if(t.optionsList.highlighted)return t._selectOption(t.optionsList.highlighted)}}(this)),this.searchBox.on("escapePress",function(t){return function(e){return t.setActive(!1)}}(this)),this.searchBox.on("arrowPress",function(t){return function(e,i){return"up"===i?t.optionsList.highlightPrevOption():"down"===i?t.optionsList.highlightNextOption():void 0}}(this)),this.optionsList.on("optionClick",function(t){return function(e,i){return t._selectOption(i)}}(this))},i.prototype._selectOption=function(t){var e;return e=t.data("option"),this.optionsList.setHighlighted(e.value),this.searchBox.textField.val(""),this.trigger("select",[e])},i.prototype.setActive=function(t){if(t!==this.active)return t?(this.el.addClass("active").appendTo(this.opts.appendTo),this.trigger("show"),this.searchBox.focus()):(this.el.removeClass("active").detach(),this.trigger("hide")),this.active=t,this},i}(e),o.exports=s},{"./options-list.coffee":5,"./search-box.coffee":8}],7:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.disabled=!1,this._render(),this._bind(),this.setSelected(this.opts.selected))}return s(i,e),i.opts={wrapper:null,placeholder:"",selected:!1,clearable:!0},i.prototype._render=function(){if(this.el=t('<div class="result-box" tabindex="0">\n  <div class="placeholder">'+this.opts.placeholder+'</div>\n  <div class="result"></div>\n  <i class="icon-expand"><span>&#9662;</span></i>\n  <a class="link-clear" href="javascript:;" tabindex="-1">\n    &#10005;\n  </a>\n</div>').appendTo(this.wrapper),this.opts.clearable)return this.el.addClass("clearable")},i.prototype._bind=function(){return this.el.on("click",function(t){return function(e){if(!t.disabled)return t.trigger("click")}}(this)),this.el.on("click",".link-clear",function(t){return function(e){if(!t.disabled)return t.trigger("clearClick"),!1}}(this)),this.el.on("keydown",function(t){return function(e){if(!t.disabled)return 13===e.which?(t.trigger("enterPress"),!1):38===e.which?(t.trigger("arrowPress",["up"]),!1):40===e.which?(t.trigger("arrowPress",["down"]),!1):void 0}}(this))},i.prototype.setSelected=function(t){if(t!==this.selected)return t?this.el.removeClass("empty").find(".result").text(t.name):this.el.addClass("empty").find(".result").text(""),this.selected=t,this},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.active=t,this},i.prototype.setDisabled=function(t){if(t!==this.disabled)return this.el.toggleClass("disabled",t),t?this.el.removeAttr("tabindex"):this.el.attr("tabindex","0"),this.disabled=t,this},i.prototype.focus=function(){return this.el.focus(),this},i}(e),o.exports=r},{}],8:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this._inputDelay=200,this._render(),this._bind())}return s(i,e),i.opts={wrapper:null,placeholder:"",hidden:!1},i.prototype._render=function(){return this.el=t('<div class="search-box">\n  <input type="text" class="text-field" tabindex="-1"\n    placeholder="'+this.opts.placeholder+'" />\n  <span class="icon-search">&#128269;</span>\n</div>').appendTo(this.wrapper),this.opts.hidden&&this.el.addClass("hidden"),this.textField=this.el.find(".text-field"),this.el},i.prototype._bind=function(){return this.textField.on("input",function(t){return function(e){return t._inputTimer&&(clearTimeout(t._inputTimer),t._inputTimer=null),t._inputTimer=setTimeout(function(){return t.trigger("change",[t.textField.val()])},t._inputDelay)}}(this)),this.textField.on("keydown",function(t){return function(e){return 13===e.which?t.trigger("enterPress"):27===e.which?(t.setValue(""),t.trigger("escapePress")):38===e.which?t.trigger("arrowPress",["up"]):40===e.which&&t.trigger("arrowPress",["down"]),null}}(this)),this.on("change",function(t,e){return this.el.toggleClass("empty",!!e)})},i.prototype.getValue=function(){return this.textField.val()},i.prototype.setValue=function(t){return this.textField.val(t),this.trigger("change",[t]),this},i.prototype.focus=function(){return this.textField.focus(),this},i}(e),o.exports=r},{}],"qing-select":[function(i,o,n){var r,s,p,l,h,a,c,u,d,f=function(t,e){function i(){this.constructor=t}for(var o in e)v.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},v={}.hasOwnProperty,g=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};r=i("./models/data-provider.coffee"),l=i("./models/option.coffee"),s=i("./html-select.coffee"),p=i("./multiple-result-box.coffee"),u=i("./result-box.coffee"),a=i("./popover.coffee"),d=i("./search-box.coffee"),h=i("./options-list.coffee"),c=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return f(i,e),i.name="QingSelect",i.opts={el:null,renderer:null,opitonRenderer:null,remote:!1,totalOptionSize:0,maxListSize:20,popoverOffset:6,popoverAppendTo:"body",searchableSize:8,locales:null},i.locales={searchPlaceholder:"Search",addSelected:"New",noOptions:"Found nothing.",hiddenSize:"__size__ more records are hidden, please search for them",loading:"Loading..."},i.prototype._setOptions=function(e){return i.__super__._setOptions.apply(this,arguments),t.extend(this.opts,i.opts,e)},i.prototype._init=function(){if(this.el=t(this.opts.el),!(this.el.length>0))throw new Error("QingSelect: option el is required");return this.opts=t.extend({},i.opts,this.opts),this.locales=t.extend({},i.locales,this.opts.locales),this.active=!1,this._render(),this._initChildComponents(),this._bind(),t.isFunction(this.opts.renderer)&&this.opts.renderer.call(this,this.wrapper),this.dataProvider.filter("")},i.prototype._render=function(){return this.wrapper=t('<div class="qing-select"></div>').insertBefore(this.el),this.el.hide().appendTo(this.wrapper).data("qingSelect",this)},i.prototype._initChildComponents=function(){var t,e;return this.htmlSelect=new s({el:this.el}),t=this.htmlSelect.getOptions(),this.dataProvider=new r({remote:this.opts.remote,options:t,totalOptionSize:this.opts.totalOptionSize}),this.multiple=this.el.is("[multiple]"),e=this.dataProvider.options.filter(function(t){return t.selected}),this.resultBox=this.multiple?new p({wrapper:this.wrapper,placeholder:this._placeholder(),selected:e,locales:this.locales}):new u({wrapper:this.wrapper,placeholder:this._placeholder(),selected:e.length>0&&e[0],clearable:!!this.htmlSelect.getBlankOption()}),this.popover=new a({wrapper:this.wrapper,dataProvider:this.dataProvider,locales:this.locales,maxListSize:this.opts.maxListSize,searchableSize:this.opts.searchableSize,appendTo:this.opts.popoverAppendTo,optionRenderer:this.opts.optionRenderer})},i.prototype._bind=function(){return this.resultBox.on("enterPress",function(t){return function(e){var i;return t.active&&!t.popover.searchable&&(i=t.popover.optionsList.highlighted)?t.selectOption(i.data("option")):t._setActive(!t.active)}}(this)),this.resultBox.on("arrowPress",function(t){return function(e,i){return t.active&&!t.popover.searchable?"up"===i?t.popover.optionsList.highlightPrevOption():t.popover.optionsList.highlightNextOption():t._setActive(!t.active)}}(this)),this.multiple?(this.resultBox.on("addClick",function(t){return function(e){return t._setActive(!0)}}(this)),this.resultBox.on("optionClick",function(t){return function(e,i){return t.unselectOption(i)}}(this))):(this.resultBox.on("click",function(t){return function(e){return t._setActive(!t.active)}}(this)),this.resultBox.on("clearClick",function(t){return function(e){if(t.resultBox.selected)return t.unselectOption(t.resultBox.selected)}}(this))),this.popover.on("select",function(t){return function(e,i){return t.selectOption(i)}}(this)),this.popover.on("show",function(t){return function(e){return t.popover.el.css(t._popoverPosition())}}(this)),this.popover.searchBox.on("escapePress",function(t){return function(e){return t._setActive(!1)}}(this)),this.dataProvider.on("beforeFilterComplete",function(e){return function(i,o,n){var r,s,p,l,h,a,c;if(c=e.htmlSelect.getValue()||[],t.isArray(c)||(c=[c]),e.multiple)return o.options=o.options.filter(function(t,e){var i;return i=t.value,!(g.call(c,i)>=0)}),o.totalSize-=c.length;for(l=o.options,a=[],r=0,s=l.length;r<s;r++)p=l[r],a.push(p.selected=(h=p.value,g.call(c,h)>=0));return a}}(this)),this.on("change",function(t){return function(e){return t.el.trigger("change")}}(this))},i.prototype._placeholder=function(){var t;return this.placeholder||(this.placeholder=this.opts.placeholder?this.opts.placeholder:(t=this.htmlSelect.getBlankOption())?t.text():"")},i.prototype._setActive=function(e){if(e!==this.active)return this.resultBox.setActive(e),this.popover.setActive(e),t(document).off("mousedown.qing-select"),e?t(document).on("mousedown.qing-select",function(e){return function(i){if(!t.contains(e.wrapper[0],i.target)&&!t.contains(e.popover.el[0],i.target)||t(i.target).is(".multiple-result-box"))return e._setActive(!1),t(document).off("mousedown.qing-select")}}(this)):this.resultBox.focus(),this.active=e,this},i.prototype._popoverPosition=function(){var t,e,i;return e=this.resultBox.el.offset(),t=this.resultBox.el.outerHeight(),i=this.resultBox.el.outerWidth(),{top:e.top+t+this.opts.popoverOffset,left:e.left,minWidth:i}},i.prototype.selectOption=function(t){var e;return t instanceof l||(t=this.dataProvider.getOption(t)),t.selected=!0,this.multiple?this.resultBox.addSelected(t):((e=this.resultBox.selected)&&(e.selected=!1,this.htmlSelect.unselectOption(e)),this.resultBox.setSelected(t)),this.htmlSelect.selectOption(t),this._setActive(!1),this.dataProvider.filter(""),this.trigger("change",[this.resultBox.selected]),this},i.prototype.unselectOption=function(t){return t instanceof l||(t=this.dataProvider.getOption(t)),t.selected=!1,this.multiple?this.resultBox.removeSelected(t):this.resultBox.setSelected(!1),this.htmlSelect.unselectOption(t),this._setActive(!1),this.dataProvider.filter(""),this.trigger("change",[this.resultBox.selected]),this},i.prototype.destroy=function(){return this.el.insertBefore(this.wrapper).show().removeData("qingSelect"),this.popover.el.remove(),this.wrapper.remove(),t(document).off(".qing-select"),this},i}(e),c.extend({DataProvider:r,Option:l,HtmlSelect:s,MultipleResultBox:p,ResultBox:u,Popover:a,SearchBox:d,OptionsList:h}),o.exports=c},{"./html-select.coffee":1,"./models/data-provider.coffee":2,"./models/option.coffee":3,"./multiple-result-box.coffee":4,"./options-list.coffee":5,"./popover.coffee":6,"./result-box.coffee":7,"./search-box.coffee":8}]},{},[]);return i("qing-select")});
=======
!function(t,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("qing-module")):t.QingSelect=e(t.jQuery,t.QingModule)}(this,function(t,e){var i=require=function t(e,i,o){function n(s,p){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!p&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var a=i[s]={exports:{}};e[s][0].call(a.exports,function(t){var i=e[s][1][t];return n(i?i:t)},a,a.exports,t,e,i,o)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.el=t(this.opts.el)}return s(i,e),i.opts={el:null},i.prototype.getOptions=function(){var t;return t=[],this.el.find("optgroup").length?this.el.find("optgroup").each(function(e){return function(i,o){var n;if(n=e._parseOptgroupEl(o))return t.push(n)}}(this)):this.el.find("option").each(function(e){return function(i,o){var n;if(n=e._parseOptionEl(o))return t.push(n)}}(this)),t},i.prototype.selectOption=function(t){var e;return e=this.el.find("option[value='"+t.value+"']"),e.length>0||(e=this._renderOption(t).appendTo(this.el)),e.prop("selected",!0),this},i.prototype.unselectOption=function(t){var e;return e=this.el.find("option[value='"+t.value+"']"),e.prop("selected",!1),this},i.prototype._parseOptgroupEl=function(e){var i,o,n;return n=[],i=t(e),o=i.prop("label"),i.find("option").each(function(t){return function(e,i){return n.push(t._parseOptionEl(i))}}(this)),[o,n]},i.prototype._parseOptionEl=function(e){var i,o,n;return i=t(e),!!(n=i.val())&&(o=i.data(),i.is(":selected")&&(o.selected=!0),[i.text(),n,o])},i.prototype._renderOption=function(e){return t("<option>",{text:e.name,value:e.value,data:e.data})},i.prototype.getValue=function(){return this.el.val()},i.prototype.setValue=function(t){return this.el.val(t),this},i.prototype.getBlankOption=function(){var t;return t=this.el.find('option:not([value]), option[value=""]'),t.length>0&&t},i}(e),o.exports=r},{}],2:[function(i,o,n){var r,s,p,l=function(t,e){function i(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;p=i("./option.coffee"),s=i("./group-option.coffee"),r=function(e){function i(e){var o;i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.remote=this.opts.remote,this.options=function(){var e,i,n,r,l,h,a,c;if(t.isArray(this.opts.options[0][1])){for(l=this.opts.options,a=[],e=0,n=l.length;e<n;e++)o=l[e],a.push(new s(o));return a}for(h=this.opts.options,c=[],i=0,r=h.length;i<r;i++)o=h[i],c.push(new p(o));return c}.call(this),this.totalOptionSize=this.opts.totalOptionSize}return l(i,e),i.opts={remote:!1,options:[],totalOptionSize:null},i.prototype._fetch=function(e,i){var o,n;if(this.remote&&this.trigger("beforeFetch")!==!1)return n=function(t){return function(o){var n;return o.options=function(){var t,e,i,r;for(i=o.options,r=[],t=0,e=i.length;t<e;t++)n=i[t],r.push(new p(n));return r}(),t.trigger("fetch",[o,e]),null!=i?i.call(t,o):void 0}}(this),t.ajax({url:this.remote.url,data:t.extend({},this.remote.params,(o={},o[""+this.remote.searchKey]=e,o)),dataType:"json"}).done(function(t){return n(t)})},i.prototype.filter=function(e,i){var o,n;return o=function(t){return function(o){return t.trigger("beforeFilterComplete",[o,e]),t.trigger("filter",[o,e]),null!=i?i.call(t,o):void 0}}(this),this.remote?e?this._fetch(e,o):o({options:this.options,totalSize:this.totalOptionSize}):(n=[],t.each(this.options,function(t,i){var o;if(console.log("----"),console.log(p),console.log("----"),"GroupOption"===i.constructor.name){if(o=i.options.filter(function(t){return t.match(e)}),o.length)return n.push(new s([i.name,o]))}else if(i.match(e))return n.push(i)}),o({options:n,totalSize:this.size()})),null},i.prototype.size=function(){var t;return"GroupOption"!==this.options[0].constructor.name?this.options.length:t=this.options.reduce(function(t,e){return t+=e.options.length},0)},i.prototype.getOption=function(t){var e;return e=this.options.filter(function(e){return function(e,i){return e.value===t}}(this)),e.length>0?e[0]:null},i}(e),r.extend({Option:p,GroupOption:s}),o.exports=r},{"./group-option.coffee":3,"./option.coffee":4}],3:[function(t,i,o){var n,r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=t("./option.coffee"),n=function(t){function e(t){var e;this.name=t[0],"Option"===(null!=(e=t[1][0])?e.constructor.name:void 0)?this.options=t[1]:this.options=function(){var e,i,o,n;for(o=t[1],n=[],e=0,i=o.length;e<i;e++)t=o[e],n.push(new r(t));return n}()}return s(e,t),e}(e),i.exports=n},{"./option.coffee":4}],4:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){this.name=e[0],this.value=e[1].toString(),this.data={},e.length>2&&t.isPlainObject(e[2])&&t.each(e[2],function(e){return function(i,o){return i=i.replace(/^data-/,"").split("-"),t.each(i,function(t,e){if(t>0)return i[t]=e.charAt(0).toUpperCase()+e.slice(1)}),e.data[i.join("")]=o,null}}(this)),this.selected=this.data.selected||!1}return s(i,e),i.prototype.match=function(t){var e,i,o;try{o=new RegExp("(^|\\s)"+t,"i")}catch(t){e=t,o=new RegExp("","i")}return i=this.data.searchKey||this.name,o.test(i)},i}(e),o.exports=r},{}],5:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.disabled=!1,this.selected=[],this._render(),this._bind(),this.opts.selected&&this.addSelected(this.opts.selected))}return s(i,e),i.opts={wrapper:null,placeholder:"",selected:!1,locales:null},i.prototype._render=function(){return this.el=t('<div class="multiple-result-box">\n  <a class="link-add" href="javascript:;">\n    <i class="icon-add">&#65291;</i>\n    <span>'+this.opts.locales.addSelected+"</span>\n  </a>\n</div>").appendTo(this.wrapper),this.linkAdd=this.el.find(".link-add")},i.prototype._bind=function(){return this.el.on("click",".link-add",function(t){return function(e){if(!t.disabled)return t.trigger("addClick")}}(this)),this.el.on("click",".selected-option",function(e){return function(i){var o;if(!e.disabled)return o=t(i.currentTarget),e.trigger("optionClick",[o.data("option")])}}(this)),this.el.on("keydown",".selected-option",function(e){return function(i){var o;if(!e.disabled)return o=t(i.currentTarget),13===i.which?(e.trigger("optionClick",[o.data("option")]),!1):void 0}}(this)),this.linkAdd.on("keydown",function(t){return function(e){if(!t.disabled)return 13===e.which?(t.trigger("enterPress"),!1):38===e.which?(t.trigger("arrowPress",["up"]),!1):40===e.which?(t.trigger("arrowPress",["down"]),!1):void 0}}(this))},i.prototype.addSelected=function(e){var i,o,n;{if(!t.isArray(e))return t('<a href="javascript:;" class="selected-option"\n  data-value="'+e.value+'">\n  <span class="name">'+e.name+'</span>\n  <i class="icon-remove">&#10005;</i>\n</a>').data("option",e).insertBefore(this.linkAdd),this.selected.push(e),this;for(i=0,o=e.length;i<o;i++)n=e[i],this.addSelected(n)}},i.prototype.removeSelected=function(t){var e,i,o,n,r,s;for(this.el.find(".selected-option[data-value='"+t.value+"']").remove(),i=-1,s=this.selected,e=o=0,n=s.length;o<n;e=++o)if(r=s[e],t.value===r.value){i=e;break}return i>-1&&this.selected.splice(i,1),this},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.active=t,this},i.prototype.setDisabled=function(t){if(t!==this.disabled)return this.el.toggleClass("disabled",t),this.disabled=t,this},i.prototype.focus=function(){return this.linkAdd.focus(),this},i}(e),o.exports=r},{}],6:[function(i,o,n){var r,s,p,l=function(t,e){return function(){return t.apply(e,arguments)}},h=function(t,e){function i(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;s=i("./models/option.coffee"),r=i("./models/group-option.coffee"),p=function(e){function i(e){this.renderOptions=l(this.renderOptions,this),i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.highlighted=!1,this._render(),this._bind())}return h(i,e),i.opts={wrapper:null,locales:null,options:null,opitonRenderer:null,totalOptionSize:null,maxListSize:0},i.prototype._render=function(){if(this.el=t('<div class="options-list"></div>').appendTo(this.wrapper),this.opts.options)return this.renderOptions(this.opts.options,this.opts.totalOptionSize)},i.prototype._bind=function(){return this.el.on("click",".option",function(e){return function(i){var o;return o=t(i.currentTarget),e.setHighlighted(o),e.trigger("optionClick",[o]),null}}(this))},i.prototype.renderOptions=function(t,e){var i;if(null==t&&(t=[]),t=t.slice(0,this.opts.maxListSize),this.el.empty().css("min-height",0),this.highlighted=!1,t.length>0?(t[0]instanceof r?this.el.append(function(){var e,o,n;for(n=[],e=0,o=t.length;e<o;e++)i=t[e],n.push(this._groupEl(i));return n}.call(this)):this.el.append(function(){var e,o,n;for(n=[],e=0,o=t.length;e<o;e++)i=t[e],n.push(this._optionEl(i));return n}.call(this)),e>this._optionLength(t)&&this._renderHiddenSize(e-this._optionLength(t))):this._renderEmpty(),!this.highlighted)return this.setHighlighted(this.el.find(".option:first"))},i.prototype._groupEl=function(e){var i,o;return i=t('<div class="group-wrapper">\n  <div class="optgroup">'+e.name+"</div>\n</div>"),i.append(function(){var t,i,n,r;for(n=e.options,r=[],t=0,i=n.length;t<i;t++)o=n[t],r.push(this._optionEl(o));return r}.call(this)),i},i.prototype._optionLength=function(t){return t[0]instanceof r?t.reduce(function(t,e){return t+=e.options.length},0):t.length},i.prototype._optionEl=function(e){var i;return i=t('<div class="option">\n  <div class="left">\n    <span class="name"></span>\n  </div>\n  <div class="right">\n    <span class="hint"></span>\n  </div>\n</div>').data("option",e),i.find(".name").text(e.data.label||e.name),e.data.hint&&i.find(".hint").text(e.data.hint),i.attr("data-value",e.value),i.data("option",e),e.selected&&this.setHighlighted(i),t.isFunction(this.opts.opitonRenderer)&&this.opts.opitonRenderer.call(this,i,e),i},i.prototype._renderEmpty=function(){return this.el.append('<div class="no-options">'+this.opts.locales.noOptions+"</div>")},i.prototype._renderHiddenSize=function(t){var e;return e=this.opts.locales.hiddenSize.replace(/__size__/g,t),this.el.append('<div class="hidden-size">'+e+"</div>")},i.prototype.setLoading=function(t){if(t!==this.loading)return t?setTimeout(function(t){return function(){if(t.loading)return t.el.addClass("loading"),t.el.append('<div class="loading-message">'+t.opts.locales.loading+"</div>")}}(this),500):(this.el.removeClass("loading"),this.el.find(".loading").remove()),this.loading=t,this},i.prototype.setHighlighted=function(t){if("object"!=typeof t&&(t=this.el.find(".option[data-value='"+t+"']")),t.length>0)return this.highlighted&&this.highlighted.removeClass("highlighted"),this.highlighted=t.addClass("highlighted"),this},i.prototype.highlightNextOption=function(){var t;if(this.highlighted?(t=this.highlighted.next(".option"),t.length||(t=this.highlighted.closest(".group-wrapper").next(".group-wrapper").find(".option:first"))):t=this.el.find(".option:first"),t.length>0)return this.setHighlighted(t)},i.prototype.highlightPrevOption=function(){var t;if(this.highlighted?(t=this.highlighted.prev(".option"),t.length||(t=this.highlighted.closest(".group-wrapper").prev(".group-wrapper").find(".option:last"))):t=this.el.find(".option:first"),t.length>0)return this.setHighlighted(t)},i}(e),p.extend({Option:s,GroupOption:r}),o.exports=p},{"./models/group-option.coffee":3,"./models/option.coffee":4}],7:[function(i,o,n){var r,s,p,l=function(t,e){function i(){this.constructor=t}for(var o in e)h.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;p=i("./search-box.coffee"),r=i("./options-list.coffee"),s=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,p.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.dataProvider=this.opts.dataProvider,this.searchable=this.dataProvider.totalOptionSize>this.dataProvider.size()||this.dataProvider.size()>this.opts.searchableSize,this._render(),this._initChildComponents(),this._bind())}return l(i,e),i.opts={wrapper:null,dataProvider:null,locales:null,maxListSize:0,searchableSize:8,opitonRenderer:null},i.prototype._render=function(){return this.el=t('<div class="qing-select-popover">')},i.prototype._initChildComponents=function(){return this.searchBox=new p({wrapper:this.el,placeholder:this.opts.locales.searchPlaceholder,hidden:!this.searchable}),this.optionsList=new r({wrapper:this.el,locales:this.opts.locales,optionRenderer:this.opts.optionRenderer,totalOptionSize:this.dataProvider.totalOptionSize,maxListSize:this.opts.maxListSize})},i.prototype._bind=function(){return this.searchBox.on("change",function(t){return function(e,i){return t.optionsList.setLoading(!0),t.dataProvider.filter(i)}}(this)),this.dataProvider.on("filter",function(t){return function(e,i,o){return t.optionsList.setLoading(!1),t.optionsList.renderOptions(i.options,i.totalSize)}}(this)),this.searchBox.on("enterPress",function(t){return function(e){if(t.optionsList.highlighted)return t._selectOption(t.optionsList.highlighted)}}(this)),this.searchBox.on("escapePress",function(t){return function(e){return t.setActive(!1)}}(this)),this.searchBox.on("arrowPress",function(t){return function(e,i){return"up"===i?t.optionsList.highlightPrevOption():"down"===i?t.optionsList.highlightNextOption():void 0}}(this)),this.optionsList.on("optionClick",function(t){return function(e,i){return t._selectOption(i)}}(this))},i.prototype._selectOption=function(t){var e;return e=t.data("option"),this.optionsList.setHighlighted(e.value),this.searchBox.textField.val(""),this.trigger("select",[e])},i.prototype.setActive=function(t){if(t!==this.active)return t?(this.el.addClass("active").appendTo(this.opts.appendTo),this.trigger("show"),this.searchBox.focus()):(this.el.removeClass("active").detach(),this.trigger("hide")),this.active=t,this},i}(e),o.exports=s},{"./options-list.coffee":6,"./search-box.coffee":9}],8:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this.active=!1,this.disabled=!1,this._render(),this._bind(),this.setSelected(this.opts.selected))}return s(i,e),i.opts={wrapper:null,placeholder:"",selected:!1,clearable:!0},i.prototype._render=function(){if(this.el=t('<div class="result-box" tabindex="0">\n  <div class="placeholder">'+this.opts.placeholder+'</div>\n  <div class="result"></div>\n  <i class="icon-expand"><span>&#9662;</span></i>\n  <a class="link-clear" href="javascript:;" tabindex="-1">\n    &#10005;\n  </a>\n</div>').appendTo(this.wrapper),this.opts.clearable)return this.el.addClass("clearable")},i.prototype._bind=function(){return this.el.on("click",function(t){return function(e){if(!t.disabled)return t.trigger("click")}}(this)),this.el.on("click",".link-clear",function(t){return function(e){if(!t.disabled)return t.trigger("clearClick"),!1}}(this)),this.el.on("keydown",function(t){return function(e){if(!t.disabled)return 13===e.which?(t.trigger("enterPress"),!1):38===e.which?(t.trigger("arrowPress",["up"]),!1):40===e.which?(t.trigger("arrowPress",["down"]),!1):void 0}}(this))},i.prototype.setSelected=function(t){if(t!==this.selected)return t?this.el.removeClass("empty").find(".result").text(t.name):this.el.addClass("empty").find(".result").text(""),this.selected=t,this},i.prototype.setActive=function(t){if(t!==this.active)return this.el.toggleClass("active",t),this.active=t,this},i.prototype.setDisabled=function(t){if(t!==this.disabled)return this.el.toggleClass("disabled",t),t?this.el.removeAttr("tabindex"):this.el.attr("tabindex","0"),this.disabled=t,this},i.prototype.focus=function(){return this.el.focus(),this},i}(e),o.exports=r},{}],9:[function(i,o,n){var r,s=function(t,e){function i(){this.constructor=t}for(var o in e)p.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},p={}.hasOwnProperty;r=function(e){function i(e){i.__super__.constructor.apply(this,arguments),t.extend(this.opts,i.opts,e),this.wrapper=t(this.opts.wrapper),this.wrapper.length>0&&(this._inputDelay=200,this._render(),this._bind())}return s(i,e),i.opts={wrapper:null,placeholder:"",hidden:!1},i.prototype._render=function(){return this.el=t('<div class="search-box">\n  <input type="text" class="text-field" tabindex="-1"\n    placeholder="'+this.opts.placeholder+'" />\n  <span class="icon-search">&#128269;</span>\n</div>').appendTo(this.wrapper),this.opts.hidden&&this.el.addClass("hidden"),this.textField=this.el.find(".text-field"),this.el},i.prototype._bind=function(){return this.textField.on("input",function(t){return function(e){return t._inputTimer&&(clearTimeout(t._inputTimer),t._inputTimer=null),t._inputTimer=setTimeout(function(){return t.trigger("change",[t.textField.val()])},t._inputDelay)}}(this)),this.textField.on("keydown",function(t){return function(e){return 13===e.which?t.trigger("enterPress"):27===e.which?(t.setValue(""),t.trigger("escapePress")):38===e.which?t.trigger("arrowPress",["up"]):40===e.which&&t.trigger("arrowPress",["down"]),null}}(this)),this.on("change",function(t,e){return this.el.toggleClass("empty",!!e)})},i.prototype.getValue=function(){return this.textField.val()},i.prototype.setValue=function(t){return this.textField.val(t),this.trigger("change",[t]),this},i.prototype.focus=function(){return this.textField.focus(),this},i}(e),o.exports=r},{}],"qing-select":[function(i,o,n){var r,s,p,l,h,a,c,u=function(t,e){function i(){this.constructor=t}for(var o in e)d.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},d={}.hasOwnProperty,f=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};r=i("./models/data-provider.coffee"),l=i("./models/option.coffee"),s=i("./html-select.coffee"),p=i("./multiple-result-box.coffee"),c=i("./result-box.coffee"),h=i("./popover.coffee"),a=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return u(i,e),i.name="QingSelect",i.opts={el:null,renderer:null,opitonRenderer:null,remote:!1,totalOptionSize:0,maxListSize:20,popoverOffset:6,popoverAppendTo:"body",searchableSize:8,locales:null},i.locales={searchPlaceholder:"Search",addSelected:"New",noOptions:"Found nothing.",hiddenSize:"__size__ more records are hidden, please search for them",loading:"Loading..."},i.prototype._setOptions=function(e){return i.__super__._setOptions.apply(this,arguments),t.extend(this.opts,i.opts,e)},i.prototype._init=function(){if(this.el=t(this.opts.el),!(this.el.length>0))throw new Error("QingSelect: option el is required");return this.opts=t.extend({},i.opts,this.opts),this.locales=t.extend({},i.locales,this.opts.locales),this.active=!1,this._render(),this._initChildComponents(),this._bind(),t.isFunction(this.opts.renderer)&&this.opts.renderer.call(this,this.wrapper),this.dataProvider.filter("")},i.prototype._render=function(){return this.wrapper=t('<div class="qing-select"></div>').insertBefore(this.el),this.el.hide().appendTo(this.wrapper).data("qingSelect",this)},i.prototype._initChildComponents=function(){var t,e;return this.htmlSelect=new s({el:this.el}),t=this.htmlSelect.getOptions(),this.dataProvider=new r({remote:this.opts.remote,options:t,totalOptionSize:this.opts.totalOptionSize}),this.multiple=this.el.is("[multiple]"),e=this.dataProvider.options.filter(function(t){return t.selected}),this.resultBox=this.multiple?new p({wrapper:this.wrapper,placeholder:this._placeholder(),selected:e,locales:this.locales}):new c({wrapper:this.wrapper,placeholder:this._placeholder(),selected:e.length>0&&e[0],clearable:!!this.htmlSelect.getBlankOption()}),this.popover=new h({wrapper:this.wrapper,dataProvider:this.dataProvider,locales:this.locales,maxListSize:this.opts.maxListSize,searchableSize:this.opts.searchableSize,appendTo:this.opts.popoverAppendTo,optionRenderer:this.opts.optionRenderer})},i.prototype._bind=function(){return this.resultBox.on("enterPress",function(t){return function(e){var i;return t.active&&!t.popover.searchable&&(i=t.popover.optionsList.highlighted)?t.selectOption(i.data("option")):t._setActive(!t.active)}}(this)),this.resultBox.on("arrowPress",function(t){return function(e,i){return t.active&&!t.popover.searchable?"up"===i?t.popover.optionsList.highlightPrevOption():t.popover.optionsList.highlightNextOption():t._setActive(!t.active)}}(this)),this.multiple?(this.resultBox.on("addClick",function(t){return function(e){return t._setActive(!0)}}(this)),this.resultBox.on("optionClick",function(t){return function(e,i){return t.unselectOption(i)}}(this))):(this.resultBox.on("click",function(t){return function(e){return t._setActive(!t.active)}}(this)),this.resultBox.on("clearClick",function(t){return function(e){if(t.resultBox.selected)return t.unselectOption(t.resultBox.selected)}}(this))),this.popover.on("select",function(t){return function(e,i){return t.selectOption(i)}}(this)),this.popover.on("show",function(t){return function(e){return t.popover.el.css(t._popoverPosition())}}(this)),this.popover.searchBox.on("escapePress",function(t){return function(e){return t._setActive(!1)}}(this)),this.dataProvider.on("beforeFilterComplete",function(e){return function(i,o,n){var r,s,p,l,h,a,c;if(c=e.htmlSelect.getValue()||[],t.isArray(c)||(c=[c]),e.multiple)return o.options=o.options.filter(function(t,e){var i;return i=t.value,!(f.call(c,i)>=0)}),o.totalSize-=c.length;for(l=o.options,a=[],r=0,s=l.length;r<s;r++)p=l[r],a.push(p.selected=(h=p.value,f.call(c,h)>=0));return a}}(this)),this.on("change",function(t){return function(e){return t.el.trigger("change")}}(this))},i.prototype._placeholder=function(){var t;return this.placeholder||(this.placeholder=this.opts.placeholder?this.opts.placeholder:(t=this.htmlSelect.getBlankOption())?t.text():"")},i.prototype._setActive=function(e){if(e!==this.active)return this.resultBox.setActive(e),this.popover.setActive(e),t(document).off("mousedown.qing-select"),e?t(document).on("mousedown.qing-select",function(e){return function(i){if(!t.contains(e.wrapper[0],i.target)&&!t.contains(e.popover.el[0],i.target)||t(i.target).is(".multiple-result-box"))return e._setActive(!1),t(document).off("mousedown.qing-select")}}(this)):this.resultBox.focus(),this.active=e,this},i.prototype._popoverPosition=function(){var t,e,i;return e=this.resultBox.el.offset(),t=this.resultBox.el.outerHeight(),i=this.resultBox.el.outerWidth(),{top:e.top+t+this.opts.popoverOffset,left:e.left,minWidth:i}},i.prototype.selectOption=function(t){var e;return t instanceof l||(t=this.dataProvider.getOption(t)),t.selected=!0,this.multiple?this.resultBox.addSelected(t):((e=this.resultBox.selected)&&(e.selected=!1,this.htmlSelect.unselectOption(e)),this.resultBox.setSelected(t)),this.htmlSelect.selectOption(t),this._setActive(!1),this.dataProvider.filter(""),this.trigger("change",[this.resultBox.selected]),this},i.prototype.unselectOption=function(t){return t instanceof l||(t=this.dataProvider.getOption(t)),t.selected=!1,this.multiple?this.resultBox.removeSelected(t):this.resultBox.setSelected(!1),this.htmlSelect.unselectOption(t),this._setActive(!1),this.dataProvider.filter(""),this.trigger("change",[this.resultBox.selected]),this},i.prototype.destroy=function(){return this.el.insertBefore(this.wrapper).show().removeData("qingSelect"),this.popover.el.remove(),this.wrapper.remove(),t(document).off(".qing-select"),this},i}(e),a.extend({DataProvider:r,Option:l,HtmlSelect:s,MultipleResultBox:p,ResultBox:c,Popover:h}),o.exports=a},{"./html-select.coffee":1,"./models/data-provider.coffee":2,"./models/option.coffee":4,"./multiple-result-box.coffee":5,"./popover.coffee":7,"./result-box.coffee":8}]},{},[]);return i("qing-select")});
>>>>>>> ADD: support option group
